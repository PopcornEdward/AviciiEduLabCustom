---
// 1. 引入 Astro Image 组件
import { Image } from 'astro:assets';

// 2. 保持原本的图片导入 (Astro 会自动处理这些 import 作为一个 ImageMetadata 对象)
import wa from "@/images/linkme/WA-icon.png";
import ig from "@/images/linkme/IG-icon.png";
import tt from "@/images/linkme/tk-icon.png";

// 注意：删除了 const waIcon = wa.src; 这种写法，因为 Image 组件直接接收 import 的对象

const waIconUrl = "https://wa.me/8615258887529?text=I would like to inquire about your products.";
const igIconUrl = "https://www.instagram.com/simplifythecomplex_wish?igsh=MWZvOGpxd2Zkam1oag==";
const ttIconUrl = "https://www.tiktok.com/@lucy.yoka?_r=1&_t=ZS-91adh6CcbxZ";

// Header.astro - 重新设计版
const navLinks = [
  { name: 'HOME', href: '/' },
  { name: 'BLOG', href: '/blog' },
  { name: 'SHOP', href: '/shop' },
  // { name: 'WORK', href: '/work' },
  // { name: 'CONTACT', href: '/contact' },
];
---

<header class="sticky top-0 z-50 bg-gradient-to-b from-white/80 to-gray-50/80 backdrop-blur-md shadow-md border-b border-gray-100/50 dark:from-gray-900/80 dark:to-gray-800/80 dark:border-gray-800/50 transition-colors duration-300">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-24">
      
      <div class="flex items-center space-x-6">
        <a href="/" class="flex-shrink-0 text-2xl font-extrabold tracking-tight text-gray-900 dark:text-white">
          <span class="text-blue-600">Avicii</span> Lab
        </a>

        <nav class="hidden md:block h-full">
          <ul class="flex space-x-4 h-full items-center">
            {navLinks.map((link) => (
              <li>
                <a href={link.href} class="text-base font-medium text-gray-700 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 transition-colors duration-200">
                  {link.name}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </div>

      <div class="flex items-center space-x-2">
        
        <button id="search-toggle" aria-label="Search" class="p-3 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors text-xl">
          <i class="fas fa-search"></i>
        </button>

        <a href="/cart" aria-label="Cart" class="p-3 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors relative text-xl">
          <i class="fas fa-shopping-cart"></i>
        </a>
        
        <a href={waIconUrl} target="_blank" aria-label="WhatsApp" class="hidden sm:inline-block p-3 transition-colors">
          <Image src={wa} alt="WhatsApp" class="w-8 h-8 object-contain" />
        </a>
        
        <a href={igIconUrl} target="_blank" aria-label="Instagram" class="hidden sm:inline-block p-3 transition-colors">
          <Image src={ig} alt="Instagram" class="w-8 h-8 object-contain" />
        </a>
        
        <a href={ttIconUrl} target="_blank" aria-label="TikTok" class="hidden sm:inline-block p-3 transition-colors">
          <Image src={tt} alt="TikTok" class="w-8 h-8 object-contain" />
        </a>
        
        <button id="theme-toggle" aria-label="Toggle Dark Mode" class="p-3 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors relative z-50">
          <svg class="theme-switch-icon w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20V4Z" class="left-half-fill" />
            <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4V20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4Z" class="right-half-fill" />
          </svg>
        </button>
        
        <button id="mobile-menu-toggle" aria-label="Mobile Menu" class="p-3 md:hidden text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white transition-colors relative z-[999] text-xl">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </div>
    
    <div id="mobile-menu" class="hidden pb-4 md:hidden"> 
      <nav class="flex flex-col space-y-2">
        {navLinks.map((link) => (
          <a href={link.href} class="text-base font-medium p-3 rounded text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800 transition-colors">
            {link.name}
          </a>
        ))}
      </nav>
    </div>

  </div>
</header>

<div id="search-modal" class="fixed inset-0 bg-black bg-opacity-70 z-[9999] hidden flex items-start justify-center pt-20">
  <div class="bg-white dark:bg-gray-900 w-full max-w-2xl p-6 rounded-lg shadow-xl transition-all duration-300">
    <button id="search-close" class="absolute top-4 right-4 text-xl text-gray-600 dark:text-gray-400 hover:text-red-500 transition-colors">
      <i class="fas fa-times"></i>
    </button>
    <h3 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">站内搜索</h3>
    <input type="search" placeholder="输入关键词搜索产品..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white"/>
    </div>
</div>

<div class="fixed bottom-4 left-4 z-50 sm:hidden flex flex-col space-y-2 animate-pulse-custom">
  <a href={waIconUrl} target="_blank" aria-label="WhatsApp" class="p-4 bg-green-500 rounded-full shadow-lg hover:bg-green-600 transition-colors">
    <Image src={wa} width={40} height={40} alt="WhatsApp" class="w-10 h-10" />
  </a>
  <a href={igIconUrl} target="_blank" aria-label="Instagram" class="p-4 bg-pink-500 rounded-full shadow-lg hover:bg-pink-600 transition-colors">
    <Image src={ig} width={40} height={40} alt="Instagram" class="w-10 h-10" />
  </a>
  <a href={ttIconUrl} target="_blank" aria-label="TikTok" class="p-4 bg-black rounded-full shadow-lg hover:bg-gray-800 transition-colors">
    <Image src={tt} width={40} height={40} alt="TikTok" class="w-10 h-10" />
  </a>
</div>

<style is:global>
    /* 定义 SVG 填充颜色变量 */
    :root {
        --light-half-color: #F8F8F8;
        --dark-half-color: #333333;
    }

    html.dark {
        --light-half-color: #333333;
        --dark-half-color: #F8F8F8;
    }

    /* 默认主题 (亮模式) */
    .theme-switch-icon .left-half-fill {
        fill: var(--dark-half-color);
        transition: fill 0.3s ease;
    }
    .theme-switch-icon .right-half-fill {
        fill: var(--light-half-color);
        transition: fill 0.3s ease;
    }

    /* 暗黑主题 */
    html.dark .theme-switch-icon .left-half-fill {
        fill: var(--light-half-color);
    }
    html.dark .theme-switch-icon .right-half-fill {
        fill: var(--dark-half-color);
    }

    /* 自定义脉冲动画 */
    @keyframes pulse-custom {
        0%, 100% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.1);
            opacity: 0.8;
        }
    }
    .animate-pulse-custom {
        animation: pulse-custom 2s infinite;
    }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    
    // A. 暗黑模式切换逻辑
    const themeToggle = document.getElementById('theme-toggle');
    const htmlEl = document.documentElement;

    const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    if (currentTheme === 'dark') {
      htmlEl.classList.add('dark');
    } else {
      htmlEl.classList.remove('dark');
    }

    themeToggle?.addEventListener('click', () => {
      if (htmlEl.classList.contains('dark')) {
        htmlEl.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        htmlEl.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    });

    // B. 搜索弹窗逻辑
    const searchToggle = document.getElementById('search-toggle');
    const searchClose = document.getElementById('search-close');
    const searchModal = document.getElementById('search-modal');

    searchToggle?.addEventListener('click', () => {
      searchModal?.classList.remove('hidden');
      searchModal?.classList.add('flex');
    });

    searchClose?.addEventListener('click', () => {
      searchModal?.classList.add('hidden');
      searchModal?.classList.remove('flex');
    });
    
    // C. 移动菜单切换逻辑
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuToggle && mobileMenu) {
      mobileMenuToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }
  });
</script>